<!DOCTYPE html>
<html lang="en">

<head>
    <!-- Your head content here -->
    <script src="https://kit.fontawesome.com/8045a273a1.js" crossorigin="anonymous"></script>
    <title>Dashboard</title>
    <link rel="stylesheet" type="text/css" href="/css/dashboard.css">
</head>

<body>
    <div class="navi">
        <nav>
            <a href="/logout" class="logout-container"><i class="fa-solid fa-right-from-bracket"></i></a>
            <div class="left-links">
                <a href="/dashboard" style="background-color:#333333;">Dashboard</a>
                <a href="/analyzer">Analyze</a>
                <a href="#learn">Learn</a>
                <a href="#theme">Light theme <i class="fa-solid fa-circle-half-stroke"></i></a>
            </div>
            <div class="right-links">
                <a href="/profile" rel="noopener noreferrer"><i class="fa-solid fa-user"></i>  <%= uname %><i class="fa-solid fa-angle-down"></i></a>
            </div>
        </nav>
    </div>
    
    <form action="/dashboard" method="get">
        <input type="text" id="handle" placeholder="Enter Codefoces id" name="handle" value="<%= locals.handle || '' %>"
            required>
        <input type="text" id="tags" placeholder="Enter problem tag" name="tags" value="<%= locals.tags || '' %>"
            required>
        <button type="submit"><i class="fa-solid fa-magnifying-glass"></i></button>
    </form>

    <nav class="rating">
        <!-- Add event listeners to the rating buttons -->
        <button type="button" class="rating-button" value="800" onclick="logRating(800)">800</button>
        <button type="button" class="rating-button" value="900" onclick="logRating(900)">900</button>
        <button type="button" class="rating-button" value="1000" onclick="logRating(1000)">1000</button>
        <button type="button" class="rating-button" value="1100" onclick="logRating(1100)">1100</button>
        <button type="button" class="rating-button" value="1200" onclick="logRating(1200)">1200</button>
        <button type="button" class="rating-button" value="1300" onclick="logRating(1300)">1300</button>
        <button type="button" class="rating-button" value="1400" onclick="logRating(1400)">1400</button>
        <button type="button" class="rating-button" value="1500" onclick="logRating(1500)">1500</button>
        <button type="button" class="rating-button" value="1600" onclick="logRating(1600)">1600</button>
    </nav>

    <div class="default-data-container" style="text-align: center;">
        <% if (typeof error !== 'undefined' && error !== null) { %>
        <div class="default-data">
            <i class="fa-brands fa-codepen"></i>
            <p>" <%= error %> "</p>
            <p>Enter a your valid credentials</p>
        </div>
        <% } else if (problems && problems.length > 0) { %>
        <div class="topic_name">
            <% if (problems && problems.length === 0) { %>
            <p class="topic_name_error"><%= locals.handle %> -> <%= locals.topic_name %> topic not found!</p>
            <% } else { %>
            <p class="topic_name_right"> <%= locals.handle %> -> { <%= locals.topic_name %> } </p>
            <% } %>
            <div style="text-align: center; margin-top: 20px; color: green;">
                <% if (typeof totalSolvedProblems !== 'undefined') { %>
                <p>Total problems solved: <%= totalSolvedProblems %></p> 
                <% } %>
            </div>

            <table>
                <thead>
                    <!-- Add the line above the table -->
                    <!-- Table header -->
                    <tr>
                        <th>S.No</th>
                        <th>Problem Name</th>
                        <th>Tags</th>
                        <th>Rating</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <!-- Table body -->
                <% problems
                    .filter(problem => problem.rating !== undefined && problem.rating !== null)
                    .sort((a, b) => (a.rating || Infinity) - (b.rating || Infinity))
                    .slice(0, 400) // Display only the first 30 problems
                    .forEach((problem, index) => { %>
                <tr>
                    <td><%= index + 1 %></td>
                    <td>
                        <a href="<%= `https://codeforces.com/problemset/problem/${problem.contestId}/${problem.index}` %>"
                            class="td-problem" target="_blank" style="text-decoration: none; color: 
                        <% if (locals.uniqueAcceptedProblems.includes(problem.name)) { %>
                            #53fe53<% /* Green for accepted */ %>
                        <% } else if (locals.timeLimitExceededProblems.includes(problem.name)) { %>
                            orange<% /* Yellow for Time Limit Exceeded */ %>
                        <% } else if (locals.wrongAnswerProblems.includes(problem.name)) { %>
                            #b90e0a<% /* Red for Wrong Answer */ %>
                        <% } else { %>
                            inherit<% /* Default color */ %>
                        <% } %>;">
                            <%= problem.name %>
                            <% if (locals.uniqueAcceptedProblems.includes(problem.name)) { %>
                            <i class="fas fa-check-circle" style="color: #53fe53;"></i><% /* Display checkmark for accepted */ %>
                            <% } %>
                        </a>
                    </td>
                    <td><%= problem.tags.join(', ') %></td>
                    <td><%= problem.rating != null ? problem.rating : '-' %></td>
                    <td class="Status_bar" style="color: 
                        <% if (locals.uniqueAcceptedProblems.includes(problem.name)) { %>
                            #53fe53<% /* Green for accepted */ %>
                        <% } else if (locals.timeLimitExceededProblems.includes(problem.name)) { %>
                            orange<% /* Yellow for Time Limit Exceeded */ %>
                        <% } else if (locals.wrongAnswerProblems.includes(problem.name)) { %>
                            #b90e0a<% /* Red for Wrong Answer */ %>
                        <% } else { %>
                            inherit<% /* Default color */ %>
                        <% } %>;">
                        <% if (locals.uniqueAcceptedProblems.includes(problem.name)) { %>
                            Accepted<% /* Accepted */ %>
                        <% } else if (locals.timeLimitExceededProblems.includes(problem.name)) { %>
                            TLE<% /* Time Limit Exceeded */ %>
                        <% } else if (locals.wrongAnswerProblems.includes(problem.name)) { %>
                            Wrong Answer<% /* Wrong Answer */ %>
                        <% } else { %>
                            -<% /* Default */ %>
                        <% } %>
                    </td>
                </tr>
                <% }); %>
            </tbody>
            </table>
            <% } else { %>
            <div class="topic_name">
                <% if (problems && problems.length === 0) { %>
                <p class="topic_name_error"><%= locals.handle %> -> <%= locals.topic_name %> topic not found!</p>
                <% } %>
            </div>
            <div class="default-data">
                <i class="fa-brands fa-codepen"></i>
                <p>No data available / Error fetching problems </p>
                <p>Enter a valid topic</p>
            </div>
            <% } %>
        </div>
    </div>
</body>

<script>
    let selectedRating = null; // Variable to store the selected rating

const ratingButtons = document.querySelectorAll('.rating-button');

ratingButtons.forEach(button => {
    button.addEventListener('click', () => {
        // Deselect all buttons
        ratingButtons.forEach(btn => btn.classList.remove('selected'));

        // Select the clicked button
        button.classList.add('selected');

        // Update the selected rating
        selectedRating = parseInt(button.value);

        // Call the logRating function
        logRating();
    });
});

function logRating() {
    if (selectedRating !== null) {
        // Make an AJAX request to log the rating on the server
        fetch(`/log-rating?rating=${selectedRating}`)
            .then(response => response.json())
            .then(data => {
                console.log(`Selected Rating: ${data.rating}`);

                // If you want to update the UI based on the server response, do it here
                // For example, you can add a class to the selected button
                ratingButtons.forEach(btn => {
                    if (parseInt(btn.value) === selectedRating) {
                        btn.classList.add('selected');
                    }
                });
            })
            .catch(error => console.error('Error logging rating:', error));
    } else {
        console.log('No rating selected');
    }
}
</script>

</html>
